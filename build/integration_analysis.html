<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анализ методов численного интегрирования</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/regression@2.0.1/dist/regression.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
            text-align: center;
        }
        .chart-container {
            position: relative;
            height: 500px;
            margin: 30px 0;
        }
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .method-info {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .method-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 10px;
            flex: 1;
            min-width: 200px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .summary {
            background: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .trend-info {
            background: #f0f8f0;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .grid-2col {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Анализ методов численного интегрирования</h1>
        
        <div class="summary">
            <h3>Исходные данные</h3>
            <p><strong>Функция:</strong> f(x) = x²·sin(x)</p>
            <p><strong>Пределы интегрирования:</strong> [0, π]</p>
            <p><strong>Аналитическое решение:</strong> 5.869604401</p>
            <p><strong>Тестовые значения n:</strong> 10, 50, 100, 500, 1000, 5000, 10000, 50000, 100000, 500000, 1000000</p>
        </div>

        <div class="grid-2col">
            <!-- График точности -->
            <div>
                <h2>Точность методов</h2>
                <div class="chart-container">
                    <canvas id="precisionChart"></canvas>
                </div>
            </div>

            <!-- График времени -->
            <div>
                <h2>Время выполнения</h2>
                <div class="chart-container">
                    <canvas id="timeChart"></canvas>
                </div>
            </div>
        </div>

        <div class="grid-2col">
            <!-- График времени от точности -->
            <div>
                <h2>Время vs Точность</h2>
                <div class="chart-container">
                    <canvas id="timePrecisionChart"></canvas>
                </div>
            </div>

            <!-- График ошибок -->
            <div>
                <h2>Зависимость ошибки</h2>
                <div class="chart-container">
                    <canvas id="errorChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Сравнительная гистограмма -->
        <h2>Сравнение методов (n=1,000,000)</h2>
        <div class="chart-container">
            <canvas id="comparisonChart"></canvas>
        </div>

        <!-- Информация о трендах -->
        <div class="trend-info">
            <h3>Анализ трендов и сложности</h3>
            <div id="trendAnalysis">
                <!-- Тренды будут заполнены JavaScript -->
            </div>
        </div>

        <!-- Таблица с результатами -->
        <h2>Детальные результаты</h2>
        <div class="table-container">
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th>n</th>
                        <th>Left Prec</th>
                        <th>Right Prec</th>
                        <th>Mid Prec</th>
                        <th>Trap Prec</th>
                        <th>Simp Prec</th>
                        <th>Left Time</th>
                        <th>Right Time</th>
                        <th>Mid Time</th>
                        <th>Trap Time</th>
                        <th>Simp Time</th>
                    </tr>
                </thead>
                <tbody id="resultsTableBody">
                </tbody>
            </table>
        </div>

        <!-- Характеристики методов -->
        <h2>Характеристики методов интегрирования</h2>
        <div class="method-info">
            <div class="method-card">
                <h4>Левые прямоугольники</h4>
                <p><strong>Точность:</strong> O(h)</p>
                <p><strong>Сложность:</strong> O(n)</p>
                <p><strong>Применение:</strong> Базовая оценка</p>
            </div>
            <div class="method-card">
                <h4>Правые прямоугольники</h4>
                <p><strong>Точность:</strong> O(h)</p>
                <p><strong>Сложность:</strong> O(n)</p>
                <p><strong>Применение:</strong> Базовая оценка</p>
            </div>
            <div class="method-card">
                <h4>Средние прямоугольники</h4>
                <p><strong>Точность:</strong> O(h²)</p>
                <p><strong>Сложность:</strong> O(n)</p>
                <p><strong>Применение:</strong> Улучшенная точность</p>
            </div>
            <div class="method-card">
                <h4>Трапеции</h4>
                <p><strong>Точность:</strong> O(h²)</p>
                <p><strong>Сложность:</strong> O(n)</p>
                <p><strong>Применение:</strong> Баланс скорости/точности</p>
            </div>
            <div class="method-card">
                <h4>Симпсон</h4>
                <p><strong>Точность:</strong> O(h⁴)</p>
                <p><strong>Сложность:</strong> O(n)</p>
                <p><strong>Применение:</strong> Высокая точность</p>
            </div>
        </div>
    </div>

    <script>
        // Данные из C++ программы
        const nValues = [10, 50, 100, 500, 1000, 5000, 10000, 50000, 100000, 500000, 1000000];
        
        const methodNames = ["Left Rectangle", "Right Rectangle", "Mid Rectangle", "Trapezoidal", "Simpson"];
        const colors = [
            'rgba(255, 99, 132, 0.8)',
            'rgba(54, 162, 235, 0.8)',
            'rgba(255, 206, 86, 0.8)',
            'rgba(75, 192, 192, 0.8)',
            'rgba(153, 102, 255, 0.8)'
        ];
        const borderColors = [
            'rgb(255, 99, 132)',
            'rgb(54, 162, 235)',
            'rgb(255, 206, 86)',
            'rgb(75, 192, 192)',
            'rgb(153, 102, 255)'
        ];
        
        // Данные точности
        const precisionData = {"Left": [1.090721332, 2.488420104, 3.090365454, 4.487424917, 5.088388527, 6.47765608, 7.069113645, 8.390433798, 8.912527998, 9.939911335, 10.30835862], "Right": [1.090765369, 2.488640207, 3.090805656, 4.489625925, 5.09279057, 6.499670819, 7.11317146, 8.615434983, 9.397558267, 10.30349792, 10.47998893], "Mid": [1.391893898, 2.789564771, 3.391616652, 4.789554068, 5.391613979, 6.789554015, 7.391613985, 8.78955234, 9.39165011, 10.79109445, 11.39339295], "Trapezoidal": [1.09074335, 2.488530142, 3.090585499, 4.488524027, 5.090583971, 6.488523972, 7.090584098, 8.488523295, 9.090583048, 10.48729548, 11.09557163], "Simpson": [3.869834733, 6.731200609, 7.937479434, 10.73410511, 11.93855981, 14.44943979, 20, 13.97231854, 13.15387269, 12.89313729, 13.31113709]};
        
        // Данные времени
        const timeData = {"Left": [1509, 1592, 1744, 6900, 13383, 65981, 132310, 673244, 1405276, 8400398, 15650249], "Right": [1569, 1272, 1762, 6898, 13757, 66937, 134733, 670449, 1373709, 12498703, 15809506], "Mid": [1459, 1252, 1741, 7646, 136288, 94653, 269060, 757838, 1478052, 7552004, 14296970], "Trapezoidal": [742, 943, 1606, 6940, 13247, 65511, 131543, 675976, 1311539, 7576778, 14414792], "Simpson": [962, 1589, 2018, 7450, 14518, 159777, 138756, 862531, 3370082, 7553743, 18637835]};
        
        // Данные ошибок
        const errorData = {"Left": [0.08114815827, 0.003247729845, 0.0008121468168, 3.255180557e-05, 8.158521696e-06, 3.329230926e-07, 8.528769069e-08, 4.06973566e-09, 1.223128265e-09, 1.148388051e-10, 4.916334007e-11], "Right": [0.0811399305, 0.00324608429, 0.0008113240395, 3.238725011e-05, 8.076243966e-06, 3.164675473e-07, 7.705991756e-08, 2.424180856e-09, 4.003517518e-10, 4.971667522e-11, 3.311395602e-11], "Mid": [0.04056076167, 0.001623436211, 0.0004058666328, 1.62347622e-05, 4.058691302e-06, 1.62347642e-07, 4.05869125e-08, 1.623482682e-09, 4.058353653e-10, 1.617728174e-11, 4.042099988e-12], "Trapezoidal": [0.08114404438, 0.003246907067, 0.0008117354281, 3.246952784e-05, 8.11738283e-06, 3.246953195e-07, 8.117380457e-08, 3.246958258e-09, 8.117400085e-10, 3.256150904e-11, 8.024692022e-12], "Simpson": [0.0001349476316, 1.856946499e-07, 1.154836671e-08, 1.844568942e-11, 1.15196741e-12, 3.552713679e-15, 1e-20, 1.065814104e-14, 7.016609516e-14, 1.278976924e-13, 4.884981308e-14]};
        
        // Заполнение таблицы
        const tableBody = document.getElementById('resultsTableBody');
        for (let i = 0; i < nValues.length; i++) {
            const row = document.createElement('tr');
            let rowHTML = `<td>${nValues[i]}</td>`;
            
            // Точность
            for (const method of methodNames) {
                const shortName = method.split(' ')[0];
                rowHTML += `<td>${precisionData[shortName][i].toFixed(2)}</td>`;
            }
            
            // Время
            for (const method of methodNames) {
                const shortName = method.split(' ')[0];
                const time = timeData[shortName][i];
                rowHTML += `<td>${time < 1000000 ? (time/1000).toFixed(0) + 'K' : (time/1000000).toFixed(1) + 'M'}</td>`;
            }
            
            row.innerHTML = rowHTML;
            tableBody.appendChild(row);
        }
        
        // Функция для расчета тренда
        function calculateTrend(x, y) {
            const n = x.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            
            for (let i = 0; i < n; i++) {
                sumX += x[i];
                sumY += y[i];
                sumXY += x[i] * y[i];
                sumXX += x[i] * x[i];
            }
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            return { slope, intercept };
        }
        
        // Анализ трендов
        function analyzeTrends() {
            const trendAnalysis = document.getElementById('trendAnalysis');
            let analysisHTML = '<div class="grid-2col">';
            
            // Анализ для каждого метода
            methodNames.forEach((method, index) => {
                const shortName = method.split(' ')[0];
                const logN = nValues.map(n => Math.log10(n));
                const precision = precisionData[shortName];
                const time = timeData[shortName].map(t => Math.log10(t));
                
                const precisionTrend = calculateTrend(logN, precision);
                const timeTrend = calculateTrend(logN, time);
                
                analysisHTML += `
                    <div class="method-card">
                        <h4>${method}</h4>
                        <p><strong>Тренд точности:</strong> ${precisionTrend.slope.toFixed(3)}·log(n) + ${precisionTrend.intercept.toFixed(3)}</p>
                        <p><strong>Тренд времени:</strong> ${timeTrend.slope.toFixed(3)}·log(n) + ${timeTrend.intercept.toFixed(3)}</p>
                        <p><strong>Сложность:</strong> O(n) - линейная</p>
                        <p><strong>Эффективность:</strong> ${(precisionTrend.slope / timeTrend.slope).toFixed(3)}</p>
                    </div>
                `;
            });
            
            analysisHTML += '</div>';
            trendAnalysis.innerHTML = analysisHTML;
        }
        
        // Инициализация графиков
        function initializeCharts() {
            // График точности
            new Chart(document.getElementById('precisionChart'), {
                type: 'line',
                data: {
                    labels: nValues,
                    datasets: methodNames.map((method, index) => ({
                        label: method,
                        data: precisionData[method.split(' ')[0]],
                        borderColor: borderColors[index],
                        backgroundColor: colors[index],
                        tension: 0.4,
                        pointRadius: 3
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Количество разбиений n' }
                        },
                        y: {
                            title: { display: true, text: 'Количество верных знаков' }
                        }
                    }
                }
            });
            
            // График времени
            new Chart(document.getElementById('timeChart'), {
                type: 'line',
                data: {
                    labels: nValues,
                    datasets: methodNames.map((method, index) => ({
                        label: method,
                        data: timeData[method.split(' ')[0]],
                        borderColor: borderColors[index],
                        backgroundColor: colors[index],
                        tension: 0.4,
                        pointRadius: 3
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Количество разбиений n' }
                        },
                        y: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Время (наносекунды)' }
                        }
                    }
                }
            });
            
            // График времени от точности
            new Chart(document.getElementById('timePrecisionChart'), {
                type: 'scatter',
                data: {
                    datasets: methodNames.map((method, index) => ({
                        label: method,
                        data: precisionData[method.split(' ')[0]].map((prec, i) => ({
                            x: prec,
                            y: timeData[method.split(' ')[0]][i]
                        })),
                        backgroundColor: colors[index],
                        pointRadius: 4
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: { display: true, text: 'Точность (верные знаки)' }
                        },
                        y: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Время (наносекунды)' }
                        }
                    }
                }
            });
            
            // График ошибок
            new Chart(document.getElementById('errorChart'), {
                type: 'line',
                data: {
                    labels: nValues,
                    datasets: methodNames.map((method, index) => ({
                        label: method,
                        data: errorData[method.split(' ')[0]],
                        borderColor: borderColors[index],
                        backgroundColor: colors[index],
                        tension: 0.4,
                        pointRadius: 3
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Количество разбиений n' }
                        },
                        y: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Абсолютная ошибка' }
                        }
                    }
                }
            });
            
            // Сравнительная гистограмма
            const lastIndex = nValues.length - 1;
            new Chart(document.getElementById('comparisonChart'), {
                type: 'bar',
                data: {
                    labels: methodNames,
                    datasets: [{
                        label: 'Время выполнения (нс)',
                        data: methodNames.map(method => timeData[method.split(' ')[0]][lastIndex]),
                        backgroundColor: colors,
                        borderColor: borderColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Время (наносекунды)' }
                        }
                    }
                }
            });
        }
        
        // Запуск анализа
        analyzeTrends();
        initializeCharts();
    </script>
</body>
</html>